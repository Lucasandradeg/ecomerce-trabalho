<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Produto</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="container">
    <header>
        <h1><a href="index.html">Shop Fácil</a></h1>
        <a href="checkout.html" id="carrinho-link" class="btn btn-secondary">Carrinho (<span id="cart-count">0</span>)</a>
    </header>
    <main>
        <section id="produto-section">
            <p>Carregando produto...</p>
        </section>
    </main>
</div>
    
    <script src="js/carrinho.js"></script>
    <script src="js/catalogo.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Função para atualizar o contador (precisa estar aqui para funcionar nesta página)
            function atualizarContadorCarrinho() {
                const cartCount = document.getElementById("cart-count");
                if (cartCount && typeof Cart !== 'undefined') {
                    const totalItems = Cart.getItems().reduce((sum, item) => sum + item.quantidade, 0);
                    cartCount.textContent = totalItems;
                }
            }

            const BRL = n => 'R$ ' + Number(n || 0).toFixed(2);

            function getParam(name) {
                return new URL(window.location.href).searchParams.get(name);
            }

            function notFound(msg) {
                const sec = document.getElementById('produto-section');
                sec.innerHTML = `
                  <div>
                    <h1>${msg}</h1>
                    <p><a href="index.html">Voltar ao catálogo</a></p>
                  </div>
                `;
            }

            function render(prod) {
                const sec = document.getElementById('produto-section');
                sec.innerHTML = ''; // Limpa o "Carregando..."
                
                const divImg = document.createElement('div');
                divImg.className = 'img-container';
                const img = document.createElement('img');
                img.src = prod.imagem;
                img.alt = prod.nome;
                divImg.appendChild(img);

                const divDetails = document.createElement('div');
                divDetails.className = 'details-container';
                
                const h1 = document.createElement('h1');
                h1.id = 'produto-titulo';
                h1.textContent = prod.nome;

                const pPreco = document.createElement('p');
                pPreco.className = 'preco';
                pPreco.textContent = BRL(prod.preco);

                const pDescricao = document.createElement('p');
                pDescricao.className = 'descricao';
                pDescricao.textContent = prod.descricao;

                const qtyWrap = document.createElement('div');
                qtyWrap.className = 'qty-wrap';
                const qtyLabel = document.createElement('label');
                qtyLabel.htmlFor = 'qty';
                qtyLabel.textContent = 'Quantidade:';
                const btnDec = document.createElement('button');
                btnDec.type = 'button';
                btnDec.textContent = '−';
                const inputQty = document.createElement('input');
                inputQty.id = 'qty';
                inputQty.type = 'number';
                inputQty.min = '1';
                inputQty.value = '1';
                const btnInc = document.createElement('button');
                btnInc.type = 'button';
                btnInc.textContent = '+';
                qtyWrap.append(qtyLabel, btnDec, inputQty, btnInc);

                const actionsWrap = document.createElement('div');
                actionsWrap.className = 'actions';
                const btnAdd = document.createElement('button');
                btnAdd.textContent = 'Adicionar ao carrinho';
                const linkCheckout = document.createElement('a');
                linkCheckout.href = 'checkout.html';
                linkCheckout.className = 'btn btn-secondary';
                linkCheckout.textContent = 'Ir para o checkout';
                actionsWrap.append(btnAdd, linkCheckout);

                divDetails.append(h1, pPreco, pDescricao, qtyWrap, actionsWrap);
                sec.append(divImg, divDetails);
                
                btnInc.addEventListener('click', () => {
                    inputQty.value = String(Number(inputQty.value) + 1);
                });
                btnDec.addEventListener('click', () => {
                    inputQty.value = String(Math.max(1, Number(inputQty.value) - 1));
                });
                btnAdd.addEventListener('click', () => {
                    const quantidade = Number(inputQty.value);
                    Cart.add({ ...prod, quantidade: quantidade });
                    atualizarContadorCarrinho();
                    alert('Produto adicionado ao carrinho.');
                });
            }
            
            // Lógica principal da página
            const id = getParam('id');
            if (!id || !window.produtos) {
                notFound('Produto não encontrado ou lista de produtos indisponível.');
                return;
            }
            
            const prod = window.produtos.find(p => String(p.id) === String(id));
            if (!prod) {
                notFound('Produto não encontrado.');
                return;
            }
            
            render(prod);
            atualizarContadorCarrinho();
        });
    </script>
</body>
</html>